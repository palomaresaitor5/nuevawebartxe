---
// Import necessary components and utilities
import MainLayout from "@/layouts/MainLayout.astro";
import CardBlog from "@components/ui/cards/CardBlog.astro";
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import { SITE } from "@data/constants";

export async function getStaticPaths() {
  const blogPosts = await getCollection("blog", ({ id }) => 
    !id.includes("/") // Get posts without language prefix (Spanish)
  );
  
  // Get unique authors
  const authors = [...new Set(blogPosts.map(post => post.data.author))];
  
  return authors.map((author) => {
    const authorPosts = blogPosts.filter(post => post.data.author === author);
    return {
      params: { author: author.toLowerCase().replace(/\s+/g, '-') },
      props: { author, posts: authorPosts },
    };
  });
}

const { author, posts } = Astro.props;

const pageTitle: string = `Artículos de ${author} | ${SITE.title}`;
const metaDescription = `Descubre todos los artículos escritos por ${author} en el blog de ${SITE.title}. Contenido especializado en diseño web, SEO y desarrollo.`;
const ogTitle = `Artículos de ${author} | Blog | ${SITE.title}`;
---

<MainLayout
  title={pageTitle}
  customDescription={metaDescription}
  customOgTitle={ogTitle}
  structuredData={{
    "@context": "https://schema.org",
    "@type": "ProfilePage",
    "@id": `https://artxeweb.com/autor/${author.toLowerCase().replace(/\s+/g, '-')}`,
    url: `https://artxeweb.com/autor/${author.toLowerCase().replace(/\s+/g, '-')}`,
    name: `Artículos de ${author}`,
    description: metaDescription,
    mainEntity: {
      "@type": "Person",
      name: author,
      jobTitle: "Especialista en Diseño Web y SEO",
      worksFor: {
        "@type": "Organization",
        name: SITE.title,
      },
    },
    isPartOf: {
      "@type": "WebSite",
      url: "https://artxeweb.com",
      name: SITE.title,
      description: SITE.description,
    },
    inLanguage: "es",
  }}
>
  <section
    class="mx-auto max-w-[85rem] space-y-8 px-4 pt-16 sm:px-6 lg:px-8 2xl:max-w-full"
  >
    {/* Page header */}
    <div class="mx-auto max-w-3xl text-left sm:text-center">
      <div class="flex items-center justify-center mb-6">
        <img
          src="https://artxeweb.com/media/files/disenador-web.svg"
          alt={`Avatar de ${author}`}
          class="w-24 h-24 rounded-full border-4 border-orange-400"
          width="96"
          height="96"
          loading="eager"
          decoding="async"
        />
      </div>
      
      <h1
        class="block text-4xl font-bold tracking-tight text-balance text-neutral-800 md:text-5xl lg:text-6xl dark:text-neutral-200"
      >
        Artículos de {author}
      </h1>

      <p
        class="mt-4 text-lg text-pretty text-neutral-600 dark:text-neutral-400"
      >
        Especialista en diseño web, SEO y desarrollo. Descubre {posts.length} artículo{posts.length !== 1 ? 's' : ''} con consejos, tutoriales y las últimas tendencias en desarrollo web.
      </p>
      
      <div class="mt-6 flex items-center justify-center space-x-4 text-sm text-neutral-500">
        <span>{posts.length} artículo{posts.length !== 1 ? 's' : ''} publicado{posts.length !== 1 ? 's' : ''}</span>
        <span>•</span>
        <span>Especialista en {SITE.title}</span>
      </div>
    </div>
  </section>

  <section
    class="mx-auto max-w-[85rem] px-4 py-10 sm:px-6 lg:px-8 lg:py-14 2xl:max-w-full"
  >
    {/* Blog posts grid */}
    <div class="grid gap-6 lg:grid-cols-2">
      {posts.map((blogEntry: CollectionEntry<"blog">) => <CardBlog blogEntry={blogEntry} />)}
    </div>
  </section>
</MainLayout>